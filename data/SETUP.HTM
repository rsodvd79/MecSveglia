<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FURGONE • Setup Wi‑Fi</title>
  <style>
    * { box-sizing: border-box; }
    :root { --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans'; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 24px 16px; }
    h1 { font-size: 20px; margin: 0 0 12px 0; }
    .card { background: var(--panel); border:1px solid #1f2937; border-radius:12px; padding:16px; }
    label { display:block; margin: 10px 0 6px; color: var(--muted); font-size: 13px; }
    input { width:100%; max-width:100%; padding:10px 12px; border-radius:10px; border:1px solid #1f2937; background:#0b1220; color:var(--text); font-size: 15px; }
    button { margin-top:14px; border:0; border-radius:10px; background:var(--accent); color:#052e16; font-weight:600; padding:12px 14px; cursor:pointer; }
    .hint { color:var(--muted); font-size:12px; margin-top:8px; }
    a { color:#93c5fd; text-decoration:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Configurazione Wi‑Fi</h1>
    <div class="card">
      <form method="post" action="/setup">
        <label for="ssid">SSID</label>
        <input id="ssid" name="ssid" type="text" required placeholder="Nome rete Wi‑Fi">

        <label for="pwd">Password</label>
        <input id="pwd" name="pwd" type="password" placeholder="Password">

        <label for="mdns">Nome mDNS (opzionale)</label>
        <input id="mdns" name="mdns" type="text" placeholder="FURGONE">

        <button type="submit">Salva e riavvia</button>
        <div class="hint">Dopo il riavvio, il dispositivo proverà a connettersi alla rete indicata.</div>
      </form>
    </div>
    <p class="hint" style="margin-top:12px;">Se sei in modalità Access Point, connettiti alla rete con SSID uguale al nome mDNS del dispositivo.</p>
    <p class="hint"><a href="/">Torna alla Home</a></p>
  </div>
  <script>
    // Carica le impostazioni correnti (SSID e mDNS) senza esporre la password
    (async () => {
      try {
        const ctrl = new AbortController();
        const t = setTimeout(() => ctrl.abort(), 4000);
        const res = await fetch('/config', { cache: 'no-store', signal: ctrl.signal });
        clearTimeout(t);
        if (res.ok) {
          const j = await res.json();
          if (j.ssid) document.getElementById('ssid').value = j.ssid;
          if (j.mdns) document.getElementById('mdns').value = j.mdns;
        }
      } catch (e) { /* ignora, resta vuoto */ }
    })();
  </script>
</body>
</html>

